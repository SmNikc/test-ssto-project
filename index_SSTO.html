<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ –¢–ï–°–¢ –°–°–¢–û - –ü–æ–∏—Å–∫-–ú–æ—Ä–µ</title>
    
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –∫–∞—Ä—Ç—ã -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            color: #2d3748;
            font-size: 2.2em;
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 0 0 10px;
        }
        
        .logo {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 700;
            font-size: 18px;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 14px;
        }
        
        .tab {
            padding: 10px 20px;
            background: #e2e8f0;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            color: #4a5568;
            transition: 0.25s;
        }
        
        .tab:hover {
            background: #cbd5e0;
            transform: translateY(-2px);
        }
        
        .tab.active {
            color: white;
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 24px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: fadeIn 0.35s ease;
        }
        
        .content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 18px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            padding: 22px;
            border-radius: 14px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: 0.25s;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .stat-card h3 {
            font-size: 13px;
            text-transform: uppercase;
            opacity: 0.9;
            margin: 0 0 8px;
        }
        
        .stat-card .value {
            font-size: 34px;
            font-weight: 800;
        }
        
        form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 18px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group.full {
            grid-column: 1 / -1;
        }
        
        .form-group.highlight {
            grid-column: 1 / -1;
            background: #fff3cd;
            border: 3px solid #ff6b6b;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.15);
        }
        
        label {
            font-weight: 700;
            margin-bottom: 8px;
            color: #4a5568;
            font-size: 14px;
        }
        
        .form-group.highlight label {
            color: #d32f2f;
            font-size: 16px;
        }
        
        input, select, textarea {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: 0.2s;
            background: #fff;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.12);
        }
        
        .form-group.highlight input {
            font-family: monospace;
            font-size: 20px;
            font-weight: 700;
            border: 3px solid #ff6b6b;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
        }
        
        th {
            background: #f7fafc;
            padding: 10px 12px;
            text-align: left;
            border-bottom: 2px solid #e2e8f0;
            color: #4a5568;
        }
        
        td {
            padding: 10px 12px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        .status {
            padding: 4px 10px;
            border-radius: 14px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .status.pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status.confirmed {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status.rejected {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .alert {
            padding: 14px;
            border-radius: 9px;
            margin: 14px 0;
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }
        
        .alert.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        
        .alert.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }
        
        .alert.warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fcd34d;
        }
        
        .alert.danger {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        
        .actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 14px 0;
        }
        
        button {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            color: #fff;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.35);
        }
        
        button.secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        button.success {
            background: linear-gradient(135deg, #48bb78, #2f855a);
        }
        
        button.danger {
            background: linear-gradient(135deg, #f56565, #c53030);
        }
        
        #map {
            height: 500px;
            border-radius: 10px;
            margin-top: 14px;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        #modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        
        #modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: #fff;
            border-radius: 15px;
            padding: 24px;
            width: min(92vw, 640px);
            max-height: 80vh;
            overflow: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 14px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 800;
            color: #2d3748;
        }
        
        .close {
            font-size: 28px;
            color: #a0aec0;
            cursor: pointer;
        }
        
        .close:hover {
            color: #4a5568;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <span class="logo">–°–°</span>
                –°–∏—Å—Ç–µ–º–∞ –¢–ï–°–¢ –°–°–¢–û - –ü–æ–∏—Å–∫-–ú–æ—Ä–µ
            </h1>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('dashboard')">üìä –ì–ª–∞–≤–Ω–∞—è</button>
                <button class="tab" onclick="switchTab('new-request')">‚ûï –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞</button>
                <button class="tab" onclick="switchTab('requests')">üìã –ó–∞—è–≤–∫–∏</button>
                <button class="tab" onclick="switchTab('signals')">üì° –°–∏–≥–Ω–∞–ª—ã</button>
                <button class="tab" onclick="switchTab('terminals')">üñ•Ô∏è –¢–µ—Ä–º–∏–Ω–∞–ª—ã</button>
                <button class="tab" onclick="switchTab('map')">üó∫Ô∏è –ö–∞—Ä—Ç–∞</button>
                <button class="tab" onclick="switchTab('reports')">üìà –û—Ç—á—ë—Ç—ã</button>
            </div>
        </header>

        <!-- –ì–ª–∞–≤–Ω–∞—è -->
        <section id="dashboard" class="content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞—è–≤–∫–∏</h3>
                    <div class="value" id="stat-active">5</div>
                    <div>‚Üë +2 –∑–∞ —Å–µ–≥–æ–¥–Ω—è</div>
                </div>
                <div class="stat-card">
                    <h3>–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å–∏–≥–Ω–∞–ª–æ–≤</h3>
                    <div class="value" id="stat-signals">127</div>
                    <div>‚Üë +15 –∑–∞ –Ω–µ–¥–µ–ª—é</div>
                </div>
                <div class="stat-card">
                    <h3>–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ –æ—Ç—á–µ—Ç–æ–≤</h3>
                    <div class="value" id="stat-reports">42</div>
                    <div>‚Üë +5 –∑–∞ –º–µ—Å—è—Ü</div>
                </div>
                <div class="stat-card">
                    <h3>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤</h3>
                    <div class="value" id="stat-terminals">89</div>
                    <div>23 –ò–ù–ú–ê–†–°–ê–¢, 66 –ò–†–ò–î–ò–£–ú</div>
                </div>
            </div>
            
            <div class="alert info">
                <span>‚ÑπÔ∏è</span>
                <div>
                    <strong>–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —à—Ç–∞—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ</strong><br>
                    –ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞: <span id="last-check">—Å–µ–≥–æ–¥–Ω—è –≤ 14:30</span>
                </div>
            </div>
            
            <div class="actions">
                <button onclick="switchTab('new-request')">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
                <button class="secondary" onclick="processEmails()">üìß –û–±—Ä–∞–±–æ—Ç–∞—Ç—å Email</button>
                <button class="success" onclick="runSystemTest()">üîß –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã</button>
            </div>
        </section>

        <!-- –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ -->
        <section id="new-request" class="content">
            <h2>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–∏ –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –°–°–¢–û</h2>
            <form id="request-form" onsubmit="submitRequest(event)">
                <div class="form-group highlight">
                    <label>‚ö†Ô∏è –ù–û–ú–ï–† –°–¢–û–ô–ö–ò –°–°–¢–û (–ì–õ–ê–í–ù–´–ô –ò–î–ï–ù–¢–ò–§–ò–ö–ê–¢–û–†)</label>
                    <input name="stationNumber" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 427399999" required pattern="[0-9]{9}" 
                           title="9-–∑–Ω–∞—á–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ—Ä–º–∏–Ω–∞–ª–∞">
                    <small style="color:#d32f2f;margin-top:6px">
                        –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –ò–ù–ú–ê–†–°–ê–¢/–ò–†–ò–î–ò–£–ú - –∫–ª—é—á –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∏ –∏ —Å–∏–≥–Ω–∞–ª–∞
                    </small>
                </div>

                <div class="form-group">
                    <label>–¢–∏–ø —Ç–µ—Ä–º–∏–Ω–∞–ª–∞</label>
                    <select name="terminalType" required>
                        <option value="INMARSAT">–ò–ù–ú–ê–†–°–ê–¢</option>
                        <option value="IRIDIUM">–ò–†–ò–î–ò–£–ú</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Å—É–¥–Ω–∞</label>
                    <input name="vesselName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –í–û–õ–ì–ê-1" required>
                </div>

                <div class="form-group">
                    <label>MMSI</label>
                    <input name="mmsi" placeholder="273456789" required pattern="[0-9]{9}">
                </div>

                <div class="form-group">
                    <label>IMO</label>
                    <input name="imo" placeholder="1234567" pattern="[0-9]{7}">
                </div>

                <div class="form-group">
                    <label>–î–∞—Ç–∞ —Ç–µ—Å—Ç–∞</label>
                    <input type="date" name="testDate" required>
                </div>

                <div class="form-group">
                    <label>–í—Ä–µ–º—è —Ç–µ—Å—Ç–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                    <input type="time" name="testTime">
                </div>

                <div class="form-group">
                    <label>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ</label>
                    <input name="contactPerson" placeholder="–ö–∞–ø–∏—Ç–∞–Ω –ò–≤–∞–Ω–æ–≤ –ò.–ò." required>
                </div>

                <div class="form-group">
                    <label>Email</label>
                    <input type="email" name="email" placeholder="captain@ship.ru" required>
                </div>

                <div class="form-group">
                    <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input name="phone" placeholder="+7 (999) 123-45-67">
                </div>

                <div class="form-group full">
                    <label>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</label>
                    <textarea name="notes" rows="3" placeholder="–û—Å–æ–±—ã–µ —É—Å–ª–æ–≤–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è..."></textarea>
                </div>

                <div class="form-group full">
                    <button type="submit">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
                </div>
            </form>
        </section>

        <!-- –ó–∞—è–≤–∫–∏ -->
        <section id="requests" class="content">
            <h2>–°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
            <div class="actions">
                <button onclick="filterRequests('all')">–í—Å–µ</button>
                <button class="secondary" onclick="filterRequests('pending')">–û–∂–∏–¥–∞—é—â–∏–µ</button>
                <button class="success" onclick="filterRequests('confirmed')">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ</button>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>‚Ññ –∑–∞—è–≤–∫–∏</th>
                        <th>–ù–æ–º–µ—Ä —Å—Ç–æ–π–∫–∏</th>
                        <th>–¢–∏–ø</th>
                        <th>–°—É–¥–Ω–æ</th>
                        <th>MMSI</th>
                        <th>–î–∞—Ç–∞ —Ç–µ—Å—Ç–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="requests-tbody">
                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </tbody>
            </table>
        </section>

        <!-- –°–∏–≥–Ω–∞–ª—ã -->
        <section id="signals" class="content">
            <h2>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏–≥–Ω–∞–ª–æ–≤ –°–°–¢–û</h2>
            <table>
                <thead>
                    <tr>
                        <th>–í—Ä–µ–º—è</th>
                        <th>–ù–æ–º–µ—Ä —Å–∏–≥–Ω–∞–ª–∞</th>
                        <th>–ù–æ–º–µ—Ä —Å—Ç–æ–π–∫–∏</th>
                        <th>–¢–∏–ø —Å–∏–≥–Ω–∞–ª–∞</th>
                        <th>–°—É–¥–Ω–æ</th>
                        <th>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                </thead>
                <tbody id="signals-tbody">
                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </tbody>
            </table>
        </section>

        <!-- –¢–µ—Ä–º–∏–Ω–∞–ª—ã -->
        <section id="terminals" class="content">
            <h2>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –°–°–¢–û</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>–ò–ù–ú–ê–†–°–ê–¢</h3>
                    <div class="value" id="term-inmarsat">23</div>
                    <div>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤</div>
                </div>
                <div class="stat-card">
                    <h3>–ò–†–ò–î–ò–£–ú</h3>
                    <div class="value" id="term-iridium">66</div>
                    <div>–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤</div>
                </div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>–ù–æ–º–µ—Ä —Å—Ç–æ–π–∫–∏</th>
                        <th>–¢–∏–ø</th>
                        <th>–°—É–¥–Ω–æ</th>
                        <th>MMSI</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ç–µ—Å—Ç</th>
                    </tr>
                </thead>
                <tbody id="terminals-tbody">
                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </tbody>
            </table>
        </section>

        <!-- –ö–∞—Ä—Ç–∞ -->
        <section id="map" class="content">
            <h2>–ö–∞—Ä—Ç–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –°–°–¢–û</h2>
            <div id="mapContainer"></div>
            <div class="actions">
                <button onclick="centerMap()">üéØ –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
                <button class="secondary" onclick="toggleSignalTypes()">üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–∏–ø—ã</button>
            </div>
        </section>

        <!-- –û—Ç—á—ë—Ç—ã -->
        <section id="reports" class="content">
            <h2>–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤</h2>
            <div class="form-group">
                <label>–ü–µ—Ä–∏–æ–¥ –æ—Ç—á–µ—Ç–∞</label>
                <div style="display:flex;gap:10px;">
                    <input type="date" id="report-start">
                    <input type="date" id="report-end">
                </div>
            </div>
            <div class="actions">
                <button onclick="generateReport()">üìä –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç</button>
                <button class="secondary" onclick="generateStatistics()">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                <button class="success" onclick="exportReport()">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
            </div>
            <div id="report-content"></div>
        </section>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
        <div id="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="modal-title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</div>
                    <span class="close" onclick="closeModal()">&times;</span>
                </div>
                <div id="modal-body"></div>
            </div>
        </div>
    </div>

    <script>
        // ========== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ==========
        const API_BASE = 'http://localhost:3001';
        let USE_API = false; // –ù–∞—á–∏–Ω–∞–µ–º –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ
        
        // ========== –î–ê–ù–ù–´–ï ==========
        let requests = [];
        let signals = [];
        let terminals = [];
        let mapObj = null;
        let markers = [];
        
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã...');
            initializeData();
            updateTime();
            setInterval(updateTime, 60000);
        });
        
        // ========== –§–£–ù–ö–¶–ò–ò –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –í–ö–õ–ê–î–û–ö ==========
        function switchTab(tabName) {
            console.log('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É:', tabName);
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.content').forEach(section => {
                section.classList.remove('active');
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            const section = document.getElementById(tabName);
            if (section) {
                section.classList.add('active');
            }
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            event.target.classList.add('active');
            
            // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –∫–∞—Ä—Ç—ã
            if (tabName === 'map' && !mapObj) {
                initMap();
            }
        }
        
        // ========== –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• ==========
        function initializeData() {
            // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
            requests = [
                {
                    id: 'REQ-001',
                    stationNumber: '427399999',
                    terminalType: 'INMARSAT',
                    vesselName: '–í–û–õ–ì–ê-1',
                    mmsi: '273456789',
                    testDate: '2025-01-09',
                    status: 'pending',
                    contactPerson: '–ö–∞–ø–∏—Ç–∞–Ω –ò–≤–∞–Ω–æ–≤'
                },
                {
                    id: 'REQ-002',
                    stationNumber: '427399998',
                    terminalType: 'IRIDIUM',
                    vesselName: '–ù–ï–í–ê-2',
                    mmsi: '273456790',
                    testDate: '2025-01-08',
                    status: 'confirmed',
                    contactPerson: '–°—Ç–∞—Ä–ø–æ–º –ü–µ—Ç—Ä–æ–≤'
                },
                {
                    id: 'REQ-003',
                    stationNumber: '427399997',
                    terminalType: 'INMARSAT',
                    vesselName: '–î–£–ù–ê–ô-3',
                    mmsi: '273456791',
                    testDate: '2025-01-07',
                    status: 'pending',
                    contactPerson: '–ú–µ—Ö–∞–Ω–∏–∫ –°–∏–¥–æ—Ä–æ–≤'
                }
            ];
            
            signals = [
                {
                    id: 'SIG-1001',
                    stationNumber: '427399999',
                    signalType: 'TEST',
                    vesselName: '–í–û–õ–ì–ê-1',
                    coordinates: { lat: 55.7558, lng: 37.6173 },
                    receivedAt: new Date().toISOString(),
                    status: 'processing'
                },
                {
                    id: 'SIG-1002',
                    stationNumber: '427399998',
                    signalType: 'REAL_ALERT',
                    vesselName: '–ù–ï–í–ê-2',
                    coordinates: { lat: 59.9386, lng: 30.3141 },
                    receivedAt: new Date().toISOString(),
                    status: 'confirmed'
                }
            ];
            
            terminals = [
                {
                    stationNumber: '427399999',
                    type: 'INMARSAT',
                    vesselName: '–í–û–õ–ì–ê-1',
                    mmsi: '273456789',
                    status: 'active',
                    lastTest: '2025-01-09'
                },
                {
                    stationNumber: '427399998',
                    type: 'IRIDIUM',
                    vesselName: '–ù–ï–í–ê-2',
                    mmsi: '273456790',
                    status: 'active',
                    lastTest: '2025-01-08'
                }
            ];
            
            updateStats();
            loadRequests();
            loadSignals();
            loadTerminals();
        }
        
        // ========== –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–¢–ê–¢–ò–°–¢–ò–ö–ò ==========
        function updateStats() {
            const activeRequests = requests.filter(r => r.status === 'pending').length;
            document.getElementById('stat-active').textContent = activeRequests;
            
            document.getElementById('stat-signals').textContent = signals.length;
            
            const inmarsatCount = terminals.filter(t => t.type === 'INMARSAT').length;
            const iridiumCount = terminals.filter(t => t.type === 'IRIDIUM').length;
            document.getElementById('term-inmarsat').textContent = inmarsatCount;
            document.getElementById('term-iridium').textContent = iridiumCount;
        }
        
        // ========== –ó–ê–ì–†–£–ó–ö–ê –ó–ê–Ø–í–û–ö ==========
        function loadRequests(filter = 'all') {
            const tbody = document.getElementById('requests-tbody');
            let filtered = requests;
            
            if (filter !== 'all') {
                filtered = requests.filter(r => r.status === filter);
            }
            
            tbody.innerHTML = filtered.map(r => `
                <tr>
                    <td>${r.id}</td>
                    <td><strong>${r.stationNumber}</strong></td>
                    <td>${r.terminalType}</td>
                    <td>${r.vesselName}</td>
                    <td>${r.mmsi}</td>
                    <td>${r.testDate}</td>
                    <td><span class="status ${r.status}">${getStatusText(r.status)}</span></td>
                    <td>
                        ${r.status === 'pending' ? 
                            `<button class="success" onclick="confirmRequest('${r.id}')">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>` : 
                            ''}
                    </td>
                </tr>
            `).join('');
        }
        
        // ========== –ó–ê–ì–†–£–ó–ö–ê –°–ò–ì–ù–ê–õ–û–í ==========
        function loadSignals() {
            const tbody = document.getElementById('signals-tbody');
            
            tbody.innerHTML = signals.map(s => `
                <tr>
                    <td>${new Date(s.receivedAt).toLocaleString('ru-RU')}</td>
                    <td>${s.id}</td>
                    <td><strong>${s.stationNumber}</strong></td>
                    <td>${s.signalType}</td>
                    <td>${s.vesselName}</td>
                    <td>${s.coordinates ? `${s.coordinates.lat.toFixed(4)}¬∞, ${s.coordinates.lng.toFixed(4)}¬∞` : '-'}</td>
                    <td><span class="status ${s.status}">${getStatusText(s.status)}</span></td>
                </tr>
            `).join('');
        }
        
        // ========== –ó–ê–ì–†–£–ó–ö–ê –¢–ï–†–ú–ò–ù–ê–õ–û–í ==========
        function loadTerminals() {
            const tbody = document.getElementById('terminals-tbody');
            
            tbody.innerHTML = terminals.map(t => `
                <tr>
                    <td><strong>${t.stationNumber}</strong></td>
                    <td>${t.type}</td>
                    <td>${t.vesselName}</td>
                    <td>${t.mmsi}</td>
                    <td><span class="status ${t.status}">${getStatusText(t.status)}</span></td>
                    <td>${t.lastTest}</td>
                </tr>
            `).join('');
        }
        
        // ========== –û–¢–ü–†–ê–í–ö–ê –ó–ê–Ø–í–ö–ò ==========
        function submitRequest(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const data = Object.fromEntries(formData.entries());
            
            const newRequest = {
                id: `REQ-${Date.now()}`,
                ...data,
                status: 'pending'
            };
            
            requests.push(newRequest);
            updateStats();
            loadRequests();
            
            showModal('–£—Å–ø–µ—à–Ω–æ', `
                <div class="alert success">
                    <span>‚úÖ</span>
                    <div>
                        <strong>–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞</strong><br>
                        ‚Ññ ${newRequest.id}<br>
                        –°—Ç–æ–π–∫–∞: ${newRequest.stationNumber}<br>
                        –°—É–¥–Ω–æ: ${newRequest.vesselName}
                    </div>
                </div>
            `);
            
            event.target.reset();
            switchTab('requests');
        }
        
        // ========== –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –ó–ê–Ø–í–ö–ò ==========
        function confirmRequest(id) {
            const request = requests.find(r => r.id === id);
            if (request) {
                request.status = 'confirmed';
                loadRequests();
                updateStats();
                showModal('–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ', `
                    <div class="alert success">
                        <span>‚úÖ</span>
                        <div>–ó–∞—è–≤–∫–∞ ${id} –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞</div>
                    </div>
                `);
            }
        }
        
        // ========== –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –ó–ê–Ø–í–û–ö ==========
        function filterRequests(filter) {
            loadRequests(filter);
        }
        
        // ========== –ö–ê–†–¢–ê ==========
        function initMap() {
            if (!mapObj && document.getElementById('mapContainer')) {
                mapObj = L.map('mapContainer').setView([55.7558, 37.6173], 5);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap contributors'
                }).addTo(mapObj);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã —Å–∏–≥–Ω–∞–ª–æ–≤
                signals.forEach(s => {
                    if (s.coordinates) {
                        const marker = L.marker([s.coordinates.lat, s.coordinates.lng])
                            .addTo(mapObj)
                            .bindPopup(`
                                <strong>${s.vesselName}</strong><br>
                                –°–∏–≥–Ω–∞–ª: ${s.id}<br>
                                –°—Ç–æ–π–∫–∞: ${s.stationNumber}<br>
                                –¢–∏–ø: ${s.signalType}
                            `);
                        markers.push(marker);
                    }
                });
            }
        }
        
        function centerMap() {
            if (mapObj && markers.length > 0) {
                const group = new L.featureGroup(markers);
                mapObj.fitBounds(group.getBounds());
            }
        }
        
        function toggleSignalTypes() {
            showModal('–§–∏–ª—å—Ç—Ä —Å–∏–≥–Ω–∞–ª–æ–≤', `
                <div class="alert info">
                    <span>‚ÑπÔ∏è</span>
                    <div>–§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–∏–ø–æ–≤ —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>
                </div>
            `);
        }
        
        // ========== –û–¢–ß–ï–¢–´ ==========
        function generateReport() {
            const startDate = document.getElementById('report-start').value;
            const endDate = document.getElementById('report-end').value;
            
            if (!startDate || !endDate) {
                showModal('–û—à–∏–±–∫–∞', `
                    <div class="alert danger">
                        <span>‚ùå</span>
                        <div>–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –æ—Ç—á–µ—Ç–∞</div>
                    </div>
                `);
                return;
            }
            
            const reportHtml = `
                <div class="alert info">
                    <strong>–û—Ç—á–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω</strong><br>
                    –ü–µ—Ä–∏–æ–¥: ${startDate} - ${endDate}
                </div>
                <div class="stats-grid" style="margin-top:10px;">
                    <div class="stat-card">
                        <h3>–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</h3>
                        <div class="value">${requests.length}</div>
                    </div>
                    <div class="stat-card">
                        <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</h3>
                        <div class="value">${requests.filter(r => r.status === 'confirmed').length}</div>
                    </div>
                    <div class="stat-card">
                        <h3>–í –æ–±—Ä–∞–±–æ—Ç–∫–µ</h3>
                        <div class="value">${requests.filter(r => r.status === 'pending').length}</div>
                    </div>
                    <div class="stat-card">
                        <h3>–°–∏–≥–Ω–∞–ª–æ–≤</h3>
                        <div class="value">${signals.length}</div>
                    </div>
                </div>
            `;
            
            document.getElementById('report-content').innerHTML = reportHtml;
        }
        
        function generateStatistics() {
            showModal('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–±–æ—Ç—ã –º–æ–¥—É–ª—è –¢–ï–°–¢ –°–°–¢–û', `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>–í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫</h3>
                        <div class="value">${requests.length}</div>
                    </div>
                    <div class="stat-card">
                        <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</h3>
                        <div class="value">${requests.filter(r => r.status === 'confirmed').length}</div>
                    </div>
                    <div class="stat-card">
                        <h3>–û–∂–∏–¥–∞–µ—Ç</h3>
                        <div class="value">${requests.filter(r => r.status === 'pending').length}</div>
                    </div>
                    <div class="stat-card">
                        <h3>–°–∏–≥–Ω–∞–ª–æ–≤</h3>
                        <div class="value">${signals.length}</div>
                    </div>
                </div>
            `);
        }
        
        function exportReport() {
            showModal('–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel', `
                <div class="alert success">
                    <span>‚úÖ</span>
                    <div>–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –∫ —ç–∫—Å–ø–æ—Ä—Ç—É: SSTO_Report_${new Date().toISOString().slice(0, 10)}.xlsx</div>
                </div>
            `);
        }
        
        // ========== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û ==========
        function showModal(title, content) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-body').innerHTML = content;
            document.getElementById('modal').classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –æ–∫–Ω–∞
        window.addEventListener('click', function(e) {
            if (e.target.id === 'modal') {
                closeModal();
            }
        });
        
        // ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ==========
        function getStatusText(status) {
            const statusMap = {
                'pending': '–û–∂–∏–¥–∞–µ—Ç',
                'confirmed': '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ',
                'rejected': '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ',
                'processing': '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è',
                'active': '–ê–∫—Ç–∏–≤–µ–Ω'
            };
            return statusMap[status] || status;
        }
        
        function updateTime() {
            const now = new Date();
            const timeStr = `—Å–µ–≥–æ–¥–Ω—è –≤ ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            document.getElementById('last-check').textContent = timeStr;
        }
        
        function processEmails() {
            showModal('–û–±—Ä–∞–±–æ—Ç–∫–∞ Email', `
                <div class="alert info">
                    <span>üìß</span>
                    <div>–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ 3 –ø–∏—Å—å–º–∞, —Å–æ–∑–¥–∞–Ω–æ 2 –∑–∞—è–≤–∫–∏</div>
                </div>
            `);
        }
        
        function runSystemTest() {
            showModal('–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã', `
                <div class="alert success">
                    <span>‚úÖ</span>
                    <div>
                        <strong>–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ</strong><br>
                        ‚úì –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö<br>
                        ‚úì Email —Å–µ—Ä–≤–∏—Å<br>
                        ‚úì API –ü–æ–∏—Å–∫-–ú–æ—Ä–µ<br>
                        ‚úì –ö–∞—Ä—Ç–∞
                    </div>
                </div>
            `);
        }
        
        console.log('–°–∏—Å—Ç–µ–º–∞ –¢–ï–°–¢ –°–°–¢–û –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ');
    </script>
</body>
</html>