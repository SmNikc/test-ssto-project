<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ú–æ–¥—É–ª—å –¢–µ—Å—Ç –°–°–¢–û</title>
    <link rel="stylesheet" href="https://unpkg.com/openlayers@7.3.0/dist/ol.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        header { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 24px; }
        .logo span { font-weight: bold; }
        .actions { display: flex; gap: 10px; }
        .btn { padding: 8px 16px; border: none; cursor: pointer; border-radius: 4px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-sm { padding: 4px 8px; font-size: 0.875rem; }
        nav { margin: 20px 0; }
        .tab { padding: 10px 20px; margin-right: 5px; background: #f0f0f0; cursor: pointer; border-radius: 4px 4px 0 0; border: none; }
        .tab.active { background: white; border: 1px solid #ddd; border-bottom: none; }
        .content { display: none; padding: 20px; border: 1px solid #ddd; border-radius: 0 4px 4px 4px; }
        .content.active { display: block; }
        .stats { display: flex; gap: 20px; }
        .stat { flex: 1; padding: 20px; background: #f8f9fa; border-radius: 4px; }
        .stat h3 { margin: 0 0 10px; font-size: 14px; color: #6c757d; }
        .stat p { font-size: 24px; margin: 0; font-weight: bold; }
        .stat small { display: block; color: #6c757d; margin-top: 5px; }
        .status { margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 4px; }
        .quick-actions { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        form { display: grid; gap: 15px; max-width: 600px; }
        input, select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; width: 100%; }
        label { font-weight: bold; display: block; margin-bottom: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: left; }
        th { background: #f0f0f0; font-weight: bold; }
        #map { height: 400px; border: 1px solid #ddd; border-radius: 4px; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8em; display: inline-block; }
        .status-active { background: #d4edda; color: #155724; }
        .status-inactive { background: #f8d7da; color: #721c24; }
        .status-tested { background: #c7f3c7; color: #0d5f0d; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-confirmed { background: #cce5ff; color: #004085; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                üö¢ <span>–ú–û–î–£–õ–¨ –¢–ï–°–¢ –°–°–¢–û</span>
                <div style="font-size: 14px; color: #6c757d;">–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –°–°–¢–û</div>
            </div>
            <div class="actions">
                <button class="btn btn-primary" onclick="uploadExcel()">üìä –ó–∞–≥—Ä—É–∑–∏—Ç—å Excel</button>
                <button class="btn btn-secondary" onclick="configureEmail()">‚úâÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Email</button>
                <button class="btn btn-secondary" onclick="exportSettings()">üíæ –≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫</button>
                <button class="btn btn-secondary" onclick="importSettings()">üì• –ò–º–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫</button>
            </div>
        </header>
        
        <nav>
            <button class="tab active" data-tab="dashboard">üìä –ì–ª–∞–≤–Ω–∞—è</button>
            <button class="tab" data-tab="new-request">‚ûï –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞</button>
            <button class="tab" data-tab="requests">üìã –ó–∞—è–≤–∫–∏</button>
            <button class="tab" data-tab="signals">üì° –°–∏–≥–Ω–∞–ª—ã</button>
            <button class="tab" data-tab="terminals">üñ•Ô∏è –¢–µ—Ä–º–∏–Ω–∞–ª—ã</button>
            <button class="tab" data-tab="map">üó∫Ô∏è –ö–∞—Ä—Ç–∞</button>
            <button class="tab" data-tab="reports">üìà –û—Ç—á—ë—Ç—ã</button>
        </nav>
        
        <div id="dashboard" class="content active">
            <div class="stats">
                <div class="stat">
                    <h3>–ê–ö–¢–ò–í–ù–´–ï –ó–ê–Ø–í–ö–ò</h3>
                    <p id="active-requests">0</p>
                    <small>‚Üë +2 –∑–∞ —Å–µ–≥–æ–¥–Ω—è</small>
                </div>
                <div class="stat">
                    <h3>–û–ñ–ò–î–ê–Æ–¢ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø</h3>
                    <p id="pending-confirm">0</p>
                    <small>–¢—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è</small>
                </div>
                <div class="stat">
                    <h3>–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û</h3>
                    <p id="confirmed">0</p>
                    <small>‚Üë +5 –∑–∞ –Ω–µ–¥–µ–ª—é</small>
                </div>
                <div class="stat">
                    <h3>–í–°–ï–ì–û –°–ò–ì–ù–ê–õ–û–í</h3>
                    <p id="total-signals">0</p>
                    <small>–ó–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</small>
                </div>
            </div>
            <div class="status">
                <strong>–°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:</strong>
                <span id="auto-confirm-status">–û–¢–ö–õ–Æ–ß–ï–ù</span>
                <button class="btn btn-primary" onclick="toggleAutoConfirm()" style="margin-left: 20px;">–ò–∑–º–µ–Ω–∏—Ç—å —Ä–µ–∂–∏–º</button>
            </div>
            <div class="quick-actions">
                <button class="btn btn-primary" onclick="processEmailQueue()">üìß –û–±—Ä–∞–±–æ—Ç–∞—Ç—å email –æ—á–µ—Ä–µ–¥—å</button>
                <button class="btn btn-primary" onclick="syncSearchSea()">üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ü–æ–∏—Å–∫-–ú–æ—Ä–µ</button>
                <button class="btn btn-primary" onclick="generateTestData()">üé≤ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
                <button class="btn btn-primary" onclick="systemCheck()">üè• –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã</button>
                <button class="btn btn-secondary" onclick="clearAllData()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
            </div>
        </div>
        
        <div id="new-request" class="content">
            <h2>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–∏ –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –°–°–¢–û</h2>
            <form id="new-request-form">
                <div>
                    <label>‚ö†Ô∏è –ù–û–ú–ï–† –°–¢–û–ô–ö–ò –°–°–¢–û (–ì–õ–ê–í–ù–´–ô –ò–î–ï–ù–¢–ò–§–ò–ö–ê–¢–û–†) *</label>
                    <input type="text" id="terminal-number" required placeholder="9-–∑–Ω–∞—á–Ω—ã–π –Ω–æ–º–µ—Ä">
                    <small style="color: #dc3545;">–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è</small>
                </div>
                <div>
                    <label>–¢–∏–ø —Å–ø—É—Ç–Ω–∏–∫–æ–≤–æ–π —Å–≤—è–∑–∏ *</label>
                    <select id="sat-type" required>
                        <option>–ò–ù–ú–ê–†–°–ê–¢</option>
                        <option>–ò–†–ò–î–ò–£–ú</option>
                    </select>
                </div>
                <div>
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Å—É–¥–Ω–∞ *</label>
                    <input type="text" id="vessel-name" required>
                </div>
                <div>
                    <label>MMSI *</label>
                    <input type="text" id="mmsi" required placeholder="9-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥">
                </div>
                <div>
                    <label>IMO</label>
                    <input type="text" id="imo" placeholder="7-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥">
                </div>
                <div>
                    <label>–°—É–¥–æ–≤–ª–∞–¥–µ–ª–µ—Ü *</label>
                    <input type="text" id="owner" required>
                </div>
                <div>
                    <label>Email *</label>
                    <input type="email" id="email" required>
                </div>
                <div>
                    <label>–î–∞—Ç–∞ —Ç–µ—Å—Ç–∞ *</label>
                    <input type="date" id="test-date" required>
                </div>
                <div>
                    <label>–í—Ä–µ–º—è —Ç–µ—Å—Ç–∞</label>
                    <input type="time" id="test-time">
                </div>
                <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
            </form>
        </div>
        
        <div id="requests" class="content">
            <h2>–°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ù–æ–º–µ—Ä —Å—Ç–æ–π–∫–∏</th>
                        <th>–°—É–¥–Ω–æ</th>
                        <th>MMSI</th>
                        <th>IMO</th>
                        <th>–î–∞—Ç–∞ —Ç–µ—Å—Ç–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="requests-tbody">
                    <tr><td colspan="8" style="text-align: center;">–ù–µ—Ç –∑–∞—è–≤–æ–∫</td></tr>
                </tbody>
            </table>
        </div>
        
        <div id="signals" class="content">
            <h2>–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –°–°–¢–û</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>–ù–æ–º–µ—Ä —Å—Ç–æ–π–∫–∏</th>
                        <th>–°—É–¥–Ω–æ</th>
                        <th>MMSI</th>
                        <th>IMO</th>
                        <th>–¢–∏–ø</th>
                        <th>–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è</th>
                        <th>–¢–µ—Å—Ç/–¢—Ä–µ–≤–æ–≥–∞</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="signals-tbody">
                    <tr><td colspan="9" style="text-align: center;">–ù–µ—Ç —Å–∏–≥–Ω–∞–ª–æ–≤</td></tr>
                </tbody>
            </table>
        </div>
        
        <div id="terminals" class="content">
            <h2>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –°–°–¢–û</h2>
            <div style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="addTerminal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª</button>
                <button class="btn btn-secondary" onclick="exportTerminalsCSV()">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>–ù–æ–º–µ—Ä —Å—Ç–æ–π–∫–∏</th>
                        <th>–°—É–¥–Ω–æ</th>
                        <th>MMSI</th>
                        <th>–¢–∏–ø —Å–≤—è–∑–∏</th>
                        <th>–í–ª–∞–¥–µ–ª–µ—Ü</th>
                        <th>–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ç–µ—Å—Ç</th>
                        <th>–°–ª–µ–¥—É—é—â–∏–π —Ç–µ—Å—Ç</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="terminals-tbody">
                    <tr><td colspan="9" style="text-align: center;">–ù–µ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤</td></tr>
                </tbody>
            </table>
        </div>
        
        <div id="map" class="content">
            <h2>–ö–∞—Ä—Ç–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –°–°–¢–û</h2>
            <div id="map-container" style="height: 400px; border: 1px solid #ddd;"></div>
            <div style="margin-top: 20px;">
                <button class="btn btn-primary" onclick="showAllSignals()">üéØ –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</button>
                <button class="btn btn-secondary" onclick="measureDistance()">üìè –ò–∑–º–µ—Ä–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="takeScreenshot()">üì∑ –°–∫—Ä–∏–Ω—à–æ—Ç</button>
                <button class="btn btn-secondary" onclick="clearMap()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
        </div>
        
        <div id="reports" class="content">
            <h2>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤</h2>
            <div style="margin-bottom: 20px;">
                <label>–¢–∏–ø –æ—Ç—á—ë—Ç–∞</label>
                <select id="report-type" style="width: 300px;">
                    <option>–°—É—Ç–æ—á–Ω—ã–π</option>
                    <option>–ù–µ–¥–µ–ª—å–Ω—ã–π</option>
                    <option>–ú–µ—Å—è—á–Ω—ã–π</option>
                    <option>–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥</option>
                </select>
            </div>
            <div id="report-period" style="display: none; margin-bottom: 20px;">
                <label>–ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞</label>
                <input type="date" id="report-start" style="width: 300px;">
                <label style="margin-top: 10px;">–ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞</label>
                <input type="date" id="report-end" style="width: 300px;">
            </div>
            <div>
                <button class="btn btn-primary" onclick="generateReport()">üìä –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç</button>
                <button class="btn btn-secondary" onclick="exportPDF()">üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/openlayers@7.3.0/dist/ol.js"></script>
    <script src="https://unpkg.com/xlsx@latest/dist/xlsx.full.min.js"></script>
    <script>
        // –ü—Ä–æ—Å—Ç–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö
        const storage = {
            requests: [],
            signals: [],
            terminals: []
        };

        // ===================== LocalStorage Support =====================
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function saveToLocalStorage() {
            try {
                localStorage.setItem('ssto_requests', JSON.stringify(storage.requests));
                localStorage.setItem('ssto_signals', JSON.stringify(storage.signals));
                localStorage.setItem('ssto_terminals', JSON.stringify(storage.terminals));
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ LocalStorage');
            } catch(e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        function loadFromLocalStorage() {
            try {
                const requests = localStorage.getItem('ssto_requests');
                const signals = localStorage.getItem('ssto_signals');
                const terminals = localStorage.getItem('ssto_terminals');
                
                if (requests) storage.requests = JSON.parse(requests);
                if (signals) storage.signals = JSON.parse(signals);
                if (terminals) storage.terminals = JSON.parse(terminals);
                
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ LocalStorage');
                console.log('  –ó–∞—è–≤–∫–∏:', storage.requests.length);
                console.log('  –°–∏–≥–Ω–∞–ª—ã:', storage.signals.length);
                console.log('  –¢–µ—Ä–º–∏–Ω–∞–ª—ã:', storage.terminals.length);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                updateDashboard();
                loadRequests();
                loadSignals();
                loadTerminals();
            } catch(e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
            }
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        function clearAllData() {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                localStorage.removeItem('ssto_requests');
                localStorage.removeItem('ssto_signals');
                localStorage.removeItem('ssto_terminals');
                storage.requests = [];
                storage.signals = [];
                storage.terminals = [];
                updateDashboard();
                loadRequests();
                loadSignals();
                loadTerminals();
                alert('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã');
            }
        }


        // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.content').forEach(content => {
                content.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é
            const target = document.getElementById(tabName);
            if (target) {
                target.classList.add('active');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ù–∞—Ö–æ–¥–∏–º –∏ –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.tab').forEach(tab => {
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                }
            });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫–ª–∏–∫–∏ –∫ –≤–∫–ª–∞–¥–∫–∞–º
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–∏
            const form = document.getElementById('new-request-form');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const request = {
                        id: 'REQ' + Date.now(),
                        terminal: document.getElementById('terminal-number').value,
                        vessel: document.getElementById('vessel-name').value,
                        mmsi: document.getElementById('mmsi').value,
                        imo: document.getElementById('imo').value,
                        owner: document.getElementById('owner').value,
                        email: document.getElementById('email').value,
                        testDate: document.getElementById('test-date').value,
                        testTime: document.getElementById('test-time').value,
                        status: 'pending'
                    };
                    
                    storage.requests.push(request);
            saveToLocalStorage();
                    alert('–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!');
                    form.reset();
                    updateDashboard();
                    loadRequests();
                });
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–∏–ø–∞ –æ—Ç—á–µ—Ç–∞
            const reportType = document.getElementById('report-type');
            if (reportType) {
                reportType.addEventListener('change', function() {
                    const period = document.getElementById('report-period');
                    if (this.value === '–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥') {
                        period.style.display = 'block';
                    } else {
                        period.style.display = 'none';
                    }
                });
            }

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            loadFromLocalStorage();
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function updateDashboard() {
            const activeEl = document.getElementById('active-requests');
            const pendingEl = document.getElementById('pending-confirm');
            const confirmedEl = document.getElementById('confirmed');
            const signalsEl = document.getElementById('total-signals');
            
            if (activeEl) activeEl.textContent = storage.requests.length;
            if (pendingEl) pendingEl.textContent = storage.requests.filter(r => r.status === 'pending').length;
            if (confirmedEl) confirmedEl.textContent = storage.requests.filter(r => r.status === 'confirmed').length;
            if (signalsEl) signalsEl.textContent = storage.signals.length;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫
        function loadRequests() {
            const tbody = document.getElementById('requests-tbody');
            if (!tbody) return;
            
            if (storage.requests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">–ù–µ—Ç –∑–∞—è–≤–æ–∫</td></tr>';
            } else {
                tbody.innerHTML = '';
                storage.requests.forEach(req => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${req.id}</td>
                        <td>${req.terminal}</td>
                        <td>${req.vessel}</td>
                        <td>${req.mmsi}</td>
                        <td>${req.imo || '-'}</td>
                        <td>${req.testDate}</td>
                        <td><span class="status-badge status-${req.status}">${req.status}</span></td>
                        <td><button class="btn btn-primary btn-sm" onclick="confirmRequest('${req.id}')">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button></td>
                    `;
                    tbody.appendChild(row);
                });
            }
        }

        // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏
        function confirmRequest(id) {
            const request = storage.requests.find(r => r.id === id);
            if (request) {
                request.status = 'confirmed';
                saveToLocalStorage();
                loadRequests();
                updateDashboard();
                alert('–ó–∞—è–≤–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!');
            }
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function generateTestData() {
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞—è–≤–∫—É
            storage.requests.push({
                id: 'REQ' + Date.now(),
                terminal: '427309676',
                vessel: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å—É–¥–Ω–æ',
                mmsi: '273456789',
                imo: '1234567',
                owner: '–¢–µ—Å—Ç–æ–≤—ã–π –≤–ª–∞–¥–µ–ª–µ—Ü',
                email: 'test@example.com',
                testDate: new Date().toISOString().split('T')[0],
                status: 'pending'
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª
            storage.signals.push({
                id: 'SIG' + Date.now(),
                terminal: '427309676',
                vessel: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å—É–¥–Ω–æ',
                mmsi: '273456789',
                type: '–ò–ù–ú–ê–†–°–ê–¢',
                received: new Date().toLocaleString(),
                isTest: true
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª
            storage.terminals.push({
                terminal_number: '427309676',
                vessel_name: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å—É–¥–Ω–æ',
                mmsi: '273456789',
                type: '–ò–ù–ú–ê–†–°–ê–¢',
                owner: '–¢–µ—Å—Ç–æ–≤—ã–π –≤–ª–∞–¥–µ–ª–µ—Ü',
                lastTest: new Date().toISOString().split('T')[0],
                status: 'active'
            });
            
            updateDashboard();
            loadRequests();
            loadSignals();
            loadTerminals();
            
            saveToLocalStorage();
            alert('–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã!');
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤
        function loadSignals() {
            const tbody = document.getElementById('signals-tbody');
            if (!tbody) return;
            
            if (storage.signals.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center;">–ù–µ—Ç —Å–∏–≥–Ω–∞–ª–æ–≤</td></tr>';
            } else {
                tbody.innerHTML = '';
                storage.signals.forEach(sig => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${sig.id}</td>
                        <td>${sig.terminal}</td>
                        <td>${sig.vessel}</td>
                        <td>${sig.mmsi}</td>
                        <td>${sig.imo || '-'}</td>
                        <td>${sig.type}</td>
                        <td>${sig.received}</td>
                        <td>${sig.isTest ? '<span class="status-badge status-tested">–¢–µ—Å—Ç</span>' : '<span class="status-badge status-active">–¢—Ä–µ–≤–æ–≥–∞</span>'}</td>
                        <td><button class="btn btn-primary btn-sm" onclick="matchSignal('${sig.id}')">–°–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å</button></td>
                    `;
                    tbody.appendChild(row);
                });
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤
        function loadTerminals() {
            const tbody = document.getElementById('terminals-tbody');
            if (!tbody) return;
            
            if (storage.terminals.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center;">–ù–µ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤</td></tr>';
            } else {
                tbody.innerHTML = '';
                storage.terminals.forEach(terminal => {
                    const nextTest = terminal.lastTest ? 
                        new Date(new Date(terminal.lastTest).setFullYear(new Date(terminal.lastTest).getFullYear() + 1)).toISOString().split('T')[0] : 
                        '';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${terminal.terminal_number}</td>
                        <td>${terminal.vessel_name}</td>
                        <td>${terminal.mmsi}</td>
                        <td>${terminal.type}</td>
                        <td>${terminal.owner}</td>
                        <td>${terminal.lastTest || '-'}</td>
                        <td>${nextTest || '-'}</td>
                        <td><span class="status-badge status-${terminal.status}">${terminal.status}</span></td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="viewTerminal('${terminal.terminal_number}')">–ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                            <button class="btn btn-success btn-sm" onclick="testTerminal('${terminal.terminal_number}')">–¢–µ—Å—Ç</button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏-–∑–∞–≥–ª—É—à–∫–∏
        function uploadExcel() { alert('–ó–∞–≥—Ä—É–∑–∫–∞ Excel –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function configureEmail() { alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Email –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function exportSettings() { alert('–≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function importSettings() { alert('–ò–º–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function processEmailQueue() { alert('–û–±—Ä–∞–±–æ—Ç–∫–∞ email –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function syncSearchSea() { alert('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function systemCheck() { alert('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function toggleAutoConfirm() { 
            const status = document.getElementById('auto-confirm-status');
            if (status) {
                status.textContent = status.textContent === '–í–ö–õ–Æ–ß–ï–ù' ? '–û–¢–ö–õ–Æ–ß–ï–ù' : '–í–ö–õ–Æ–ß–ï–ù';
            }
        }
        function addTerminal() { alert('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function exportTerminalsCSV() { alert('–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function showAllSignals() { alert('–ü–æ–∫–∞–∑–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function measureDistance() { alert('–ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function takeScreenshot() { alert('–°–∫—Ä–∏–Ω—à–æ—Ç –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function clearMap() { alert('–û—á–∏—Å—Ç–∫–∞ –∫–∞—Ä—Ç—ã –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function generateReport() { alert('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function exportPDF() { alert('–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function matchSignal(id) { alert('–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞ ' + id); }
        function viewTerminal(id) { alert('–ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ ' + id); }
        function testTerminal(id) { alert('–¢–µ—Å—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ ' + id); }
    </script>
</body>
</html>