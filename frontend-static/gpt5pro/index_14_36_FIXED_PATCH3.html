<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–¥—É–ª—å –¢–ï–°–¢ –°–°–¢–û - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º</title>
    
    <!-- OpenLayers –¥–ª—è –∫–∞—Ä—Ç—ã -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.3.0/ol.css">
    <script src="https://cdn.jsdelivr.net/npm/ol@v7.3.0/dist/ol.js"></script>
    
    <!-- XLSX –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- jsPDF –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã –¥–ª—è PDF -->
    
    
    <style>
        /* ===== –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }
        
        .logo-text h1 {
            font-size: 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 2px;
        }
        
        .logo-text p {
            font-size: 12px;
            color: #666;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .navigation {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin: 20px auto;
            max-width: 1400px;
            border-radius: 10px;
            padding: 10px;
        }
        
        .tabs {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: #4a5568;
            transition: 0.3s;
        }
        
        .tab:hover {
            background: #f7fafc;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .content-area {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .tab-content {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            animation: fadeIn 0.3s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-card .change {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* –§–æ—Ä–º—ã */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-group.highlight {
            background: #fff3cd;
            border: 3px solid #ff6b6b;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .form-group.highlight label {
            color: #d32f2f;
            font-size: 18px;
            font-weight: bold;
        }
        
        .form-group.highlight input {
            font-size: 20px;
            font-weight: bold;
            border: 3px solid #ff6b6b;
        }
        
        /* –¢–∞–±–ª–∏—Ü—ã */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th {
            background: #f7fafc;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #4a5568;
            border-bottom: 2px solid #e2e8f0;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        tr:hover {
            background: #f7fafc;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }
        
        .status-confirmed {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-active {
            background: #dbeafe;
            color: #1e40af;
        }
        
        /* –ö–∞—Ä—Ç–∞ */
        #map {
            height: 500px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .map-controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #2d3748;
        }
        
        .modal-close {
            font-size: 30px;
            color: #a0aec0;
            cursor: pointer;
            background: none;
            border: none;
        }
        
        .modal-close:hover {
            color: #4a5568;
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 3000;
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        .notification.success {
            background: #48bb78;
        }
        
        .notification.error {
            background: #f56565;
        }
        
        .notification.info {
            background: #4299e1;
        }
        
        /* –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ */
        #excel-upload {
            display: none;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">üö¢</div>
                <div class="logo-text">
                    <h1>–ú–û–î–£–õ–¨ –¢–ï–°–¢ –°–°–¢–û</h1>
                    <p>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –°–°–¢–û</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="window.excelLoader.openFileDialog()">üìä –ó–∞–≥—Ä—É–∑–∏—Ç—å Excel</button>
                <button class="btn btn-secondary" onclick="window.emailSender.configureSMTP()">‚úâÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Email</button>
                <button class="btn btn-secondary" onclick="exportSettings()">üíæ –≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫</button>
                <button class="btn btn-secondary" onclick="importSettings()">üì• –ò–º–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫</button>
            </div>
        </div>
    </div>
    
    <div class="navigation">
        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard')">üìä –ì–ª–∞–≤–Ω–∞—è</button>
            <button class="tab" onclick="switchTab('new-request')">‚ûï –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞</button>
            <button class="tab" onclick="switchTab('requests')">üìã –ó–∞—è–≤–∫–∏</button>
            <button class="tab" onclick="switchTab('signals')">üì° –°–∏–≥–Ω–∞–ª—ã</button>
            <button class="tab" onclick="switchTab('terminals')">üñ•Ô∏è –¢–µ—Ä–º–∏–Ω–∞–ª—ã</button>
            <button class="tab" onclick="switchTab('map-container')">üó∫Ô∏è –ö–∞—Ä—Ç–∞</button>
            <button class="tab" onclick="switchTab('reports')">üìà –û—Ç—á—ë—Ç—ã</button>
        </div>
    </div>
    
    <div class="content-area">
        <!-- –ì–ª–∞–≤–Ω–∞—è -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>–ê–ö–¢–ò–í–ù–´–ï –ó–ê–Ø–í–ö–ò</h3>
                    <div class="value" id="total-requests">0</div>
                    <div class="change">‚Üë +2 –∑–∞ —Å–µ–≥–æ–¥–Ω—è</div>
                </div>
                <div class="stat-card">
                    <h3>–û–ñ–ò–î–ê–Æ–¢ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–Ø</h3>
                    <div class="value" id="pending-requests">0</div>
                    <div class="change">–¢—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è</div>
                </div>
                <div class="stat-card">
                    <h3>–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û</h3>
                    <div class="value" id="confirmed-requests">0</div>
                    <div class="change">‚Üë +5 –∑–∞ –Ω–µ–¥–µ–ª—é</div>
                </div>
                <div class="stat-card">
                    <h3>–í–°–ï–ì–û –°–ò–ì–ù–ê–õ–û–í</h3>
                    <div class="value" id="total-signals">0</div>
                    <div class="change">–ó–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü</div>
                </div>
            </div>
            
            <div style="background: #e6fffa; border: 2px solid #38b2ac; border-radius: 10px; padding: 20px; margin-bottom: 20px;">
                <h3 style="color: #234e52; margin-bottom: 10px;">–°—Ç–∞—Ç—É—Å –∞–≤—Ç–æ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</h3>
                <p>–†–µ–∂–∏–º: <strong id="auto-confirm-status">–û–¢–ö–õ–Æ–ß–ï–ù</strong></p>
                <button class="btn btn-primary" onclick="toggleAutoConfirm()">–ò–∑–º–µ–Ω–∏—Ç—å —Ä–µ–∂–∏–º</button>
            </div>
            
            <div class="map-controls">
                <button class="btn btn-primary" onclick="processEmailQueue()">üìß –û–±—Ä–∞–±–æ—Ç–∞—Ç—å email –æ—á–µ—Ä–µ–¥—å</button>
                <button class="btn btn-primary" onclick="syncWithPoiskMore()">üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ü–æ–∏—Å–∫-–ú–æ—Ä–µ</button>
                <button class="btn btn-secondary" onclick="generateTestData()">üé≤ –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
                <button class="btn btn-secondary" onclick="systemHealthCheck()">üè• –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã</button>
            </div>
        </div>
        
        <!-- –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ -->
        <div id="new-request" class="tab-content">
            <h2>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–∏ –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –°–°–¢–û</h2>
            <form id="request-form">
                <div class="form-group highlight">
                    <label>‚ö†Ô∏è –ù–û–ú–ï–† –°–¢–û–ô–ö–ò –°–°–¢–û (–ì–õ–ê–í–ù–´–ô –ò–î–ï–ù–¢–ò–§–ò–ö–ê–¢–û–†) *</label>
                    <input type="text" id="station-number" name="station-number" required pattern="[0-9]{9}" 
                           placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 427309676" maxlength="9">
                    <small style="color: #d32f2f;">–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è</small>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div class="form-group">
                        <label>–¢–∏–ø —Å–ø—É—Ç–Ω–∏–∫–æ–≤–æ–π —Å–≤—è–∑–∏ *</label>
                        <div>
                            <label><input type="radio" name="satcom-type" value="INMARSAT" checked> –ò–ù–ú–ê–†–°–ê–¢</label>
                            <label><input type="radio" name="satcom-type" value="IRIDIUM"> –ò–†–ò–î–ò–£–ú</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Å—É–¥–Ω–∞ *</label>
                        <input type="text" id="vessel-name" name="vessel-name" required>
                    </div>
                    
                    <div class="form-group">
                        <label>MMSI *</label>
                        <input type="text" id="mmsi" name="mmsi" required pattern="[0-9]{9}" maxlength="9">
                    </div>
                    
                    <div class="form-group">
                        <label>IMO</label>
                        <input type="text" id="imo" name="imo" pattern="[0-9]{7}" maxlength="7">
                    </div>
                    
                    <div class="form-group">
                        <label>–°—É–¥–æ–≤–ª–∞–¥–µ–ª–µ—Ü *</label>
                        <input type="text" id="ship-owner" name="ship-owner" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Email *</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    
                    <div class="form-group">
                        <label>–î–∞—Ç–∞ —Ç–µ—Å—Ç–∞ *</label>
                        <input type="date" id="test-date" name="test-date" required>
                    </div>
                    
                    <div class="form-group">
                        <label>–í—Ä–µ–º—è —Ç–µ—Å—Ç–∞</label>
                        <input type="time" id="test-time" name="test-time">
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary" style="margin-top: 20px;">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
            </form>
        </div>
        
        <!-- –ó–∞—è–≤–∫–∏ -->
        <div id="requests" class="tab-content">
            <h2>–°–ø–∏—Å–æ–∫ –∑–∞—è–≤–æ–∫ –Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
            <table>
                <thead>
                    <tr>
                    <th>ID</th>
                    <th>–ù–æ–º–µ—Ä —Å—Ç–æ–π–∫–∏</th>
                    <th>–°—É–¥–Ω–æ</th>
                    <th>MMSI</th>
                    <th>IMO</th>
                    <th>–î–∞—Ç–∞ —Ç–µ—Å—Ç–∞</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
                </thead>
                <tbody id="requests-tbody">
                    <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </tbody>
            </table>
        </div>
        
        <!-- –°–∏–≥–Ω–∞–ª—ã -->
        <div id="signals" class="tab-content">
            <h2>–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –°–°–¢–û</h2>
            <table>
                <thead>
                    <tr>
                    <th>ID</th>
                    <th>–ù–æ–º–µ—Ä —Å—Ç–æ–π–∫–∏</th>
                    <th>–°—É–¥–Ω–æ</th>
                    <th>MMSI</th>
                    <th>IMO</th>
                    <th>–¢–∏–ø</th>
                    <th>–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è</th>
                    <th>–¢–µ—Å—Ç/–¢—Ä–µ–≤–æ–≥–∞</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
                </thead>
                <tbody id="signals-tbody">
                    <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </tbody>
            </table>
        </div>
        
        <!-- –¢–µ—Ä–º–∏–Ω–∞–ª—ã -->
        <div id="terminals" class="tab-content">
            <h2>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤ –°–°–¢–û</h2>
            <div class="map-controls">
                <button class="btn btn-primary" onclick="addNewTerminal()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª</button>
                <button class="btn btn-secondary" onclick="app.vesselDB.exportToCSV()">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>–ù–æ–º–µ—Ä —Å—Ç–æ–π–∫–∏</th>
                        <th>–°—É–¥–Ω–æ</th>
                        <th>MMSI</th>
                        <th>–¢–∏–ø —Å–≤—è–∑–∏</th>
                        <th>–í–ª–∞–¥–µ–ª–µ—Ü</th>
                        <th>–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ç–µ—Å—Ç</th>
                        <th>–°–ª–µ–¥—É—é—â–∏–π —Ç–µ—Å—Ç</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody id="terminals-tbody">
                    <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </tbody>
            </table>
        </div>
        
        <!-- –ö–∞—Ä—Ç–∞ -->
        <div id="map-container" class="tab-content">
            <h2>–ö–∞—Ä—Ç–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –°–°–¢–û</h2>
            <div id="map"></div>
            <div class="map-controls">
                <button class="btn btn-primary" onclick="window.mapManager.zoomToSignals()">üéØ –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</button>
                <button class="btn btn-primary" onclick="window.mapManager.measureDistance()">üìè –ò–∑–º–µ—Ä–∏—Ç—å</button>
                <button class="btn btn-secondary" onclick="window.mapManager.exportMapImage()">üì∑ –°–∫—Ä–∏–Ω—à–æ—Ç</button>
                <button class="btn btn-secondary" onclick="window.mapManager.clearMap()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
        </div>
        
        <!-- –û—Ç—á—ë—Ç—ã -->
        <div id="reports" class="tab-content">
            <h2>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤</h2>
            <div class="form-group">
                <label>–¢–∏–ø –æ—Ç—á—ë—Ç–∞</label>
                <select id="report-type">
                    <option value="daily">–°—É—Ç–æ—á–Ω—ã–π</option>
                    <option value="weekly">–ù–µ–¥–µ–ª—å–Ω—ã–π</option>
                    <option value="monthly">–ú–µ—Å—è—á–Ω—ã–π</option>
                    <option value="custom">–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥</option>
                </select>
            </div>
            <div class="map-controls">
                <button class="btn btn-primary" onclick="generateDailyReport()">üìä –°—É—Ç–æ—á–Ω—ã–π –æ—Ç—á—ë—Ç</button>
                <button class="btn btn-primary" onclick="generateWeeklyReport()">üìä –ù–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç</button>
                <button class="btn btn-primary" onclick="generateMonthlyReport()">üìä –ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç</button>
                <button class="btn btn-secondary" onclick="exportReportToPDF()">üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF</button>
            </div>
            <div id="report-content" style="margin-top: 20px;">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Ç—á—ë—Ç–∞ -->
            </div>
        </div>
    </div>
    
    <!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ Excel -->
    <input type="file" id="excel-upload" accept=".xlsx,.xls,.csv">
    
    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    
    

    <script>
    
    // ===================== –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –í–ö–õ–ê–î–û–ö =====================
    function switchTab(tabName, element) {
        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        document.querySelectorAll('.content').forEach(section => {
            section.classList.remove('active');
        });
        
        const targetSection = document.getElementById(tabName);
        if (targetSection) {
            targetSection.classList.add('active');
        }
        
        // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
        document.querySelectorAll('.tab').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // –ù–∞—Ö–æ–¥–∏–º –∫–Ω–æ–ø–∫—É –ø–æ data-tab –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
        const activeBtn = element || document.querySelector(`.tab[data-tab="${tabName}"]`);
        if (activeBtn) {
            activeBtn.classList.add('active');
        }
        
        // –°–∫—Ä–æ–ª–ª–∏–º –∫ –Ω–∞—á–∞–ª—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.scrollTo({ top: 0, behavior: 'instant' });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞—Ä—Ç—É –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
        if (tabName === 'map' && window.olMap) {
            setTimeout(() => {
                window.olMap.updateSize();
            }, 100);
        }
        
        console.log('–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞:', tabName);
    }
    
    // –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –≤–∫–ª–∞–¥–æ–∫
    document.addEventListener('click', function(e) {
        const tab = e.target.closest('.tab[data-tab]');
        if (tab) {
            e.preventDefault();
            const targetId = tab.getAttribute('data-tab');
            switchTab(targetId, tab);
        }
    });

    
    // ===================== DataStore: –µ–¥–∏–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ =====================
    class DataStore {
        constructor() {
            this.keys = {
                requests: 'testRequests',
                signals: 'signals',
                terminals: 'vessels'
            };
            this.ensureArrays();
        }
        
        ensureArrays() {
            for (const k of Object.values(this.keys)) {
                if (!Array.isArray(this._get(k))) this._set(k, []);
            }
        }
        
        _get(key) { 
            try {
                return JSON.parse(localStorage.getItem(key) || '[]');
            } catch(e) {
                return [];
            }
        }
        
        _set(key, v) { 
            localStorage.setItem(key, JSON.stringify(v || [])); 
        }
        
        get(key) { 
            return this._get(this.keys[key]); 
        }
        
        set(key, v) { 
            this._set(this.keys[key], v); 
        }
        
        upsert(key, arr) {
            const store = this.get(key);
            const upserted = [];
            for (const item of arr) {
                const id = item.id || item.terminal_number || item.signal_number;
                const idx = store.findIndex(i => 
                    i.id === id || 
                    i.terminal_number === id || 
                    i.signal_number === id
                );
                if (idx > -1) {
                    store[idx] = { ...store[idx], ...item };
                } else {
                    store.push(item);
                }
                upserted.push(store[idx] || item);
            }
            this.set(key, store);
            return upserted;
        }
    }
    
    const store = new DataStore();

    
    // ===================== ExcelLoader —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º –ø–∞—Ä—Å–∏–Ω–≥–æ–º =====================
    class ExcelLoader {
        constructor(store) {
            this.store = store;
            this.mode = 'merge'; // 'merge' –∏–ª–∏ 'replace'
        }
        
        handleFile(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (evt) => {
                try {
                    const data = evt.target.result;
                    const wb = XLSX.read(data, { type: 'binary' });
                    this.processExcelData(wb);
                } catch(err) {
                    console.error('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è Excel:', err);
                    showNotification('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞ Excel', 'error');
                }
            };
            reader.readAsBinaryString(file);
        }
        
        processExcelData(wb) {
            const sheets = wb.SheetNames;
            let preview = { new: 0, updated: 0, skipped: 0 };
            const requests = [], signals = [], terminals = [];
            
            for (const sheetName of sheets) {
                const ws = wb.Sheets[sheetName];
                const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
                
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    if (row.length < 2) continue;
                    
                    const headers = rows[0];
                    const obj = {};
                    for (let j = 0; j < headers.length; j++) {
                        obj[headers[j]] = row[j];
                    }
                    
                    // –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ —Å —Ä–∞–∑–±–æ—Ä–æ–º —Å–∫–ª–µ–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
                    const parsed = this.parseRow(obj);
                    
                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º
                    if (this.hasHeader(headers, ['–ó–∞—è–≤–∫–∞', 'Request', '–ù–æ–º–µ—Ä —Å—Ç–æ–π–∫–∏', 'Terminal'])) {
                        if (parsed.terminal_number) requests.push(parsed);
                    } else if (this.hasHeader(headers, ['–°–∏–≥–Ω–∞–ª', 'Signal', '–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è'])) {
                        if (parsed.terminal_number) signals.push(parsed);
                    } else if (this.hasHeader(headers, ['–¢–µ—Ä–º–∏–Ω–∞–ª', 'Vessel', '–°—É–¥–Ω–æ', 'MMSI'])) {
                        if (parsed.terminal_number || parsed.mmsi) terminals.push(parsed);
                    }
                }
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä–µ–∂–∏–º –∑–∞–≥—Ä—É–∑–∫–∏
            if (this.mode === 'replace') {
                this.store.set('requests', requests);
                this.store.set('signals', signals);
                this.store.set('terminals', terminals);
                preview = { 
                    new: requests.length + signals.length + terminals.length, 
                    updated: 0, 
                    skipped: 0 
                };
            } else {
                const upReq = this.store.upsert('requests', requests);
                const upSig = this.store.upsert('signals', signals);
                const upTer = this.store.upsert('terminals', terminals);
                preview.new = upReq.filter(i => !i.id).length + 
                             upSig.filter(i => !i.id).length + 
                             upTer.filter(i => !i.id).length;
                preview.updated = upReq.length + upSig.length + upTer.length - preview.new;
            }
            
            showNotification(`–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω: –ù–æ–≤—ã—Ö: ${preview.new}, –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${preview.updated}`, 'success');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
            if (typeof loadDashboard === 'function') loadDashboard();
            if (typeof loadRequests === 'function') loadRequests();
            if (typeof loadSignals === 'function') loadSignals();
            if (typeof loadTerminals === 'function') loadTerminals();
        }
        
        parseRow(raw) {
            // –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–æ–º–µ—Ä —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ (9 —Ü–∏—Ñ—Ä)
            const extractTerminalNumber = (str) => {
                const match = String(str || '').match(/\b\d{9}\b/);
                return match ? match[0] : '';
            };
            
            // –ò–∑–≤–ª–µ–∫–∞–µ–º MMSI (9 —Ü–∏—Ñ—Ä)
            const extractMMSI = (str) => {
                const match = String(str || '').match(/\b\d{9}\b/);
                return match ? match[0] : '';
            };
            
            // –ò–∑–≤–ª–µ–∫–∞–µ–º IMO (7 —Ü–∏—Ñ—Ä)
            const extractIMO = (str) => {
                const match = String(str || '').match(/\b\d{7}\b/);
                return match ? match[0] : '';
            };
            
            // –ò–∑–≤–ª–µ–∫–∞–µ–º email
            const extractEmail = (str) => {
                const match = String(str || '').match(/[^\s]+@[^\s]+/);
                return match ? match[0] : '';
            };
            
            // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω
            const extractPhone = (str) => {
                const match = String(str || '').match(/\+?\d[\d\-\s()]{7,}/);
                return match ? match[0] : '';
            };
            
            // –ü–∞—Ä—Å–∏–º –¥–∞—Ç—É
            const parseDate = (str) => {
                const s = String(str || '').trim();
                if (!s) return '';
                // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤ dd.mm.yyyy, dd/mm/yyyy, yyyy-mm-dd
                const dmy = s.match(/^(\d{1,2})[./-](\d{1,2})[./-](\d{4})$/);
                if (dmy) return `${dmy[3]}-${dmy[2].padStart(2,'0')}-${dmy[1].padStart(2,'0')}`;
                const iso = s.match(/^(\d{4})-(\d{2})-(\d{2})$/);
                if (iso) return s;
                return '';
            };
            
            const result = {
                id: 'T' + Date.now() + Math.random().toString(36).slice(2, 6),
                terminal_number: extractTerminalNumber(
                    raw['–ù–æ–º–µ—Ä —Å—Ç–æ–π–∫–∏'] || raw['–ù–æ–º–µ—Ä —Ç–µ—Ä–º–∏–Ω–∞–ª–∞'] || 
                    raw['Terminal'] || raw['Station Number'] || ''
                ),
                terminal_type: String(raw['–¢–∏–ø'] || raw['–¢–∏–ø —Å–≤—è–∑–∏'] || 'INMARSAT').toUpperCase().includes('IRIDIUM') 
                    ? 'IRIDIUM' : 'INMARSAT',
                vessel_name: raw['–°—É–¥–Ω–æ'] || raw['–ù–∞–∑–≤–∞–Ω–∏–µ —Å—É–¥–Ω–∞'] || raw['Vessel'] || '',
                mmsi: extractMMSI(raw['MMSI'] || ''),
                imo: extractIMO(raw['IMO'] || ''),
                owner: raw['–°—É–¥–æ–≤–ª–∞–¥–µ–ª–µ—Ü'] || raw['–í–ª–∞–¥–µ–ª–µ—Ü'] || raw['Owner'] || '',
                email: extractEmail(raw['Email'] || raw['–ö–æ–Ω—Ç–∞–∫—Ç—ã'] || ''),
                phone: extractPhone(raw['–¢–µ–ª–µ—Ñ–æ–Ω'] || raw['Phone'] || raw['–ö–æ–Ω—Ç–∞–∫—Ç—ã'] || ''),
                lastTest: parseDate(raw['–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ç–µ—Å—Ç'] || raw['Last Test'] || ''),
                testDate: parseDate(raw['–î–∞—Ç–∞ —Ç–µ—Å—Ç–∞'] || raw['Test Date'] || ''),
                status: 'pending'
            };
            
            // –ï—Å–ª–∏ MMSI –∏ —Å—É–¥–Ω–æ —Å–∫–ª–µ–µ–Ω—ã –≤ –æ–¥–Ω–æ–º –ø–æ–ª–µ
            if (!result.mmsi && result.vessel_name) {
                const mmsi = extractMMSI(result.vessel_name);
                if (mmsi) {
                    result.mmsi = mmsi;
                    result.vessel_name = result.vessel_name.replace(mmsi, '').trim();
                }
            }
            
            return result;
        }
        
        hasHeader(headers, keywords) {
            return keywords.some(kw => 
                headers.some(h => h && h.toLowerCase().includes(kw.toLowerCase()))
            );
        }
    }
    
    const excelLoader = new ExcelLoader(store);

    
    // ===================== –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π =====================
    function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            background: ${type === 'error' ? '#ef4444' : type === 'success' ? '#10b981' : '#3b82f6'};
            color: white;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 9999;
            animation: slideIn 0.3s ease;
            max-width: 300px;
        `;
        notification.textContent = message;
        document.body.appendChild(notification);
        setTimeout(() => notification.remove(), 3000);
    }

    
    // ===================== –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ Excel =====================
    function uploadExcel() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.xlsx,.xls';
        input.onchange = (e) => excelLoader.handleFile(e);
        input.click();
    }

    
    // ===================== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã OpenLayers =====================
    let olMap;
    
    function initMap() {
        const mapEl = document.getElementById('map');
        if (!mapEl) return;
        
        if (olMap) {
            olMap.updateSize();
            return;
        }
        
        olMap = new ol.Map({
            target: 'map',
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.OSM()
                })
            ],
            view: new ol.View({
                center: ol.proj.fromLonLat([37.6173, 55.7558]),
                zoom: 4
            })
        });
    }

    
    // ===================== –§—É–Ω–∫—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö =====================
    function loadDashboard() {
        const requests = store.get('requests');
        const signals = store.get('signals');
        
        document.getElementById('active-requests').textContent = requests.length;
        document.getElementById('pending-confirm').textContent = requests.filter(r => r.status === 'pending').length;
        document.getElementById('confirmed').textContent = requests.filter(r => r.status === 'confirmed').length;
        document.getElementById('total-signals').textContent = signals.length;
        document.getElementById('auto-confirm-status').textContent = 
            localStorage.getItem('autoConfirm') === 'true' ? '–í–ö–õ–Æ–ß–ï–ù' : '–û–¢–ö–õ–Æ–ß–ï–ù';
    }
    
    function loadRequests() {
        const tbody = document.getElementById('requests-tbody');
        if (!tbody) return;
        
        const requests = store.get('requests');
        tbody.innerHTML = '';
        
        if (requests.length === 0) {
            tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;">–ù–µ—Ç –∑–∞—è–≤–æ–∫</td></tr>';
        } else {
            requests.forEach(req => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${req.id}</td>
                    <td>${req.terminal || req.terminal_number || ''}</td>
                    <td>${req.vessel || req.vessel_name || ''}</td>
                    <td>${req.mmsi || ''}</td>
                    <td>${req.imo || ''}</td>
                    <td>${req.testDate || ''}</td>
                    <td><span class="status-badge status-${req.status}">${req.status}</span></td>
                    <td><button class="btn btn-primary btn-sm" onclick="confirmRequest('${req.id}')">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button></td>
                `;
                tbody.appendChild(row);
            });
        }
    }
    
    function loadSignals() {
        const tbody = document.getElementById('signals-tbody');
        if (!tbody) return;
        
        const signals = store.get('signals');
        tbody.innerHTML = '';
        
        if (signals.length === 0) {
            tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;">–ù–µ—Ç —Å–∏–≥–Ω–∞–ª–æ–≤</td></tr>';
        } else {
            signals.forEach(sig => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sig.id}</td>
                    <td>${sig.terminal || sig.terminal_number || ''}</td>
                    <td>${sig.vessel || sig.vessel_name || ''}</td>
                    <td>${sig.mmsi || ''}</td>
                    <td>${sig.imo || ''}</td>
                    <td>${sig.type || 'INMARSAT'}</td>
                    <td>${sig.received || ''}</td>
                    <td>${sig.isTest ? '<span class="status-badge status-tested">–¢–µ—Å—Ç</span>' : '<span class="status-badge status-active">–¢—Ä–µ–≤–æ–≥–∞</span>'}</td>
                    <td><button class="btn btn-primary btn-sm" onclick="matchSignal('${sig.id}')">–°–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å</button></td>
                `;
                tbody.appendChild(row);
            });
        }
    }
    
    function loadTerminals() {
        const tbody = document.getElementById('terminals-tbody');
        if (!tbody) return;
        
        const terminals = store.get('terminals');
        tbody.innerHTML = '';
        
        if (terminals.length === 0) {
            tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;">–ù–µ—Ç —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤</td></tr>';
        } else {
            terminals.forEach(terminal => {
                let status = '–ê–∫—Ç–∏–≤–µ–Ω';
                let statusClass = 'status-active';
                
                if (terminal.status === 'inactive') {
                    status = '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω';
                    statusClass = 'status-inactive';
                } else if (terminal.status === 'tested') {
                    status = '–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω';
                    statusClass = 'status-tested';
                } else if (terminal.status === 'pending') {
                    status = '–û–∂–∏–¥–∞–µ—Ç —Ç–µ—Å—Ç–∞';
                    statusClass = 'status-pending';
                }
                
                let nextTestDate = '';
                if (terminal.lastTest) {
                    try {
                        const lastDate = new Date(terminal.lastTest);
                        if (!isNaN(lastDate.getTime())) {
                            const nextDate = new Date(lastDate);
                            nextDate.setFullYear(nextDate.getFullYear() + 1);
                            nextTestDate = nextDate.toISOString().split('T')[0];
                        }
                    } catch(e) {}
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${terminal.terminal_number || ''}</td>
                    <td>${terminal.vessel_name || terminal.name || ''}</td>
                    <td>${terminal.mmsi || ''}</td>
                    <td>${terminal.terminal_type || terminal.type || 'INMARSAT'}</td>
                    <td>${terminal.owner || ''}</td>
                    <td>${terminal.lastTest || ''}</td>
                    <td>${nextTestDate}</td>
                    <td><span class="status-badge ${statusClass}">${status}</span></td>
                    <td>
                        <button class="btn btn-primary btn-sm" onclick="viewTerminal('${terminal.id || terminal.terminal_number}')">–ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                        <button class="btn btn-success btn-sm" onclick="testTerminal('${terminal.terminal_number}')">–¢–µ—Å—Ç</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
    }
    
    // ===================== –§—É–Ω–∫—Ü–∏–∏ –¥–µ–π—Å—Ç–≤–∏–π =====================
    function confirmRequest(id) {
        const requests = store.get('requests');
        const req = requests.find(r => r.id === id);
        if (req) {
            req.status = 'confirmed';
            store.set('requests', requests);
            loadRequests();
            loadDashboard();
            showNotification('–ó–∞—è–≤–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞', 'success');
        }
    }
    
    function matchSignal(id) {
        showNotification('–§—É–Ω–∫—Ü–∏—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–∏–≥–Ω–∞–ª–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
    }
    
    function viewTerminal(id) {
        showNotification('–ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ ' + id, 'info');
    }
    
    function testTerminal(terminalNumber) {
        const signal = {
            id: 'SIG' + Date.now(),
            terminal: terminalNumber,
            terminal_number: terminalNumber,
            type: 'TEST',
            received: new Date().toISOString(),
            isTest: true
        };
        
        store.upsert('signals', [signal]);
        
        const terminals = store.get('terminals');
        const terminal = terminals.find(t => t.terminal_number === terminalNumber);
        if (terminal) {
            terminal.lastTest = new Date().toISOString().split('T')[0];
            terminal.status = 'tested';
            store.set('terminals', terminals);
        }
        
        loadTerminals();
        loadSignals();
        loadDashboard();
        showNotification('–¢–µ—Å—Ç–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω', 'success');
    }
    
    function toggleAutoConfirm() {
        const current = localStorage.getItem('autoConfirm') === 'true';
        localStorage.setItem('autoConfirm', !current);
        loadDashboard();
        showNotification('–ê–≤—Ç–æ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ' + (!current ? '–≤–∫–ª—é—á–µ–Ω–æ' : '–æ—Ç–∫–ª—é—á–µ–Ω–æ'), 'info');
    }
    
    function generateTestData() {
        const testRequest = {
            id: 'REQ' + Date.now(),
            terminal: '427309676',
            terminal_number: '427309676',
            vessel: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å—É–¥–Ω–æ',
            vessel_name: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å—É–¥–Ω–æ',
            mmsi: '273456789',
            imo: '1234567',
            owner: '–¢–µ—Å—Ç–æ–≤—ã–π –≤–ª–∞–¥–µ–ª–µ—Ü',
            testDate: new Date().toISOString().split('T')[0],
            status: 'pending'
        };
        
        const testSignal = {
            id: 'SIG' + Date.now(),
            terminal: '427309676',
            terminal_number: '427309676',
            vessel: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å—É–¥–Ω–æ',
            vessel_name: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å—É–¥–Ω–æ',
            mmsi: '273456789',
            type: 'INMARSAT',
            received: new Date().toISOString(),
            isTest: true
        };
        
        const testTerminal = {
            id: 'TERM' + Date.now(),
            terminal_number: '427309676',
            vessel_name: '–¢–µ—Å—Ç–æ–≤–æ–µ —Å—É–¥–Ω–æ',
            mmsi: '273456789',
            terminal_type: 'INMARSAT',
            owner: '–¢–µ—Å—Ç–æ–≤—ã–π –≤–ª–∞–¥–µ–ª–µ—Ü',
            lastTest: new Date().toISOString().split('T')[0],
            status: 'tested'
        };
        
        store.upsert('requests', [testRequest]);
        store.upsert('signals', [testSignal]);
        store.upsert('terminals', [testTerminal]);
        
        loadDashboard();
        loadRequests();
        loadSignals();
        loadTerminals();
        
        showNotification('–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã', 'success');
    }
    
    // –ó–∞–≥–ª—É—à–∫–∏ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
    function configureEmail() { showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ Email –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info'); }
    function exportSettings() { showNotification('–≠–∫—Å–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info'); }
    function importSettings() { showNotification('–ò–º–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info'); }
    function processEmailQueue() { showNotification('–û–±—Ä–∞–±–æ—Ç–∫–∞ email –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info'); }
    function syncSearchSea() { showNotification('–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info'); }
    function systemCheck() { showNotification('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info'); }
    function addTerminal() { showNotification('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info'); }
    function exportTerminalsCSV() { showNotification('–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info'); }
    function showAllSignals() { showNotification('–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–∏–≥–Ω–∞–ª—ã', 'info'); }
    function measureDistance() { showNotification('–ò–∑–º–µ—Ä–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è', 'info'); }
    function takeScreenshot() { showNotification('–°–∫—Ä–∏–Ω—à–æ—Ç –∫–∞—Ä—Ç—ã', 'info'); }
    function clearMap() { showNotification('–û—á–∏—Å—Ç–∫–∞ –∫–∞—Ä—Ç—ã', 'info'); }
    function generateReport() { showNotification('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞', 'info'); }
    function exportPDF() { showNotification('–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF', 'info'); }
    function viewRequest(id) { showNotification('–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞—è–≤–∫–∏ ' + id, 'info'); }
    function viewSignal(id) { showNotification('–ü—Ä–æ—Å–º–æ—Ç—Ä —Å–∏–≥–Ω–∞–ª–∞ ' + id, 'info'); }
    
    
    // ===================== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã =====================
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –°–°–¢–û...');
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        if (typeof loadDashboard === 'function') loadDashboard();
        if (typeof loadRequests === 'function') loadRequests();
        if (typeof loadSignals === 'function') loadSignals();
        if (typeof loadTerminals === 'function') loadTerminals();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É
        setTimeout(function() {
            if (typeof initMap === 'function') initMap();
        }, 100);
        
        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–µ—Ä–≤—É—é –≤–∫–ª–∞–¥–∫—É
        switchTab('dashboard');
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–∏
        const form = document.getElementById('new-request-form');
        if (form) {
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const request = {
                    id: 'REQ' + Date.now(),
                    terminal: document.getElementById('terminal-number').value,
                    satType: document.getElementById('sat-type').value,
                    vessel: document.getElementById('vessel-name').value,
                    mmsi: document.getElementById('mmsi').value,
                    imo: document.getElementById('imo').value,
                    owner: document.getElementById('owner').value,
                    email: document.getElementById('email').value,
                    testDate: document.getElementById('test-date').value,
                    testTime: document.getElementById('test-time').value,
                    status: 'pending'
                };
                
                store.upsert('requests', [request]);
                showNotification('–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞', 'success');
                form.reset();
                
                if (typeof loadDashboard === 'function') loadDashboard();
                if (typeof loadRequests === 'function') loadRequests();
            });
        }
        
        console.log('‚úÖ –°–∏—Å—Ç–µ–º–∞ –°–°–¢–û –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ');
    });

    </script>
    

  <!-- SSTOPatch v3 -->
  <script src="ssto_patch.js"></script>
</body>
</html>